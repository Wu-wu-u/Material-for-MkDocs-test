<!DOCTYPE html><html><head>
      <title>Report</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\15230\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.13\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="逻辑设计思路">逻辑设计思路 </h1>
<h2 id="整体设计">整体设计 </h2>
<p>贪吃蛇（Snake）是一个起源于1976年的街机游戏 Blockade。<br>
在游戏中，玩家操控一条细长的直线（俗称蛇或虫），它会不停前进，玩家只能操控蛇的头部朝向（上下左右），一路拾起触碰到之物（或称作“豆”），并要避免触碰到自身或者其他障碍物。每次贪吃蛇吃掉一件食物，它的身体便增长一些。<br>
本程序设计了简易版本的贪吃蛇游戏，包含开始和结束界面以及游玩界面，四周为不可穿越的障碍物，蛇可以通过吃下三种不同大小的Food来获得1-3的得分以及长度的增加。</p>
<p><img src="./design.jpg" alt="Design"></p>
<p>采用<strong>Top-Down</strong>设计思路，由<strong>top</strong>模块来组织连接其他子模块，其中主要的功能模块有<strong>Ps2,Run（运动模块）,VGA,State（状态机）,DispNum（数码管显示）,beep（蜂鸣器）</strong>;使用<strong>IP核</strong>来存储图片等数据。</p>
<p>将<strong>640*480</strong>的屏幕，以<strong>16*16</strong>为单元格，划分为<strong>40*30</strong>的区域。<br>
我们将每个单元格给予一个state状态值，分为 `<strong>0:</strong> 背景格，<strong>1:</strong> 蛇头，<strong>2:</strong> 蛇身，<strong>3:</strong> Small_Food，<strong>4:</strong> Medium_Food，<strong>5:</strong> Large_Food，<strong>6:</strong> 死亡格。</p>
<h2 id="1ps2设计思路">1.PS2设计思路 </h2>
<h3 id="运行原理">运行原理 </h3>
<p>PS/2 通信协议是一种双向同步串行通信协议。通信的两端通过 CLOCK(时钟脚)同步，并通过国 DATA(数据脚)交换数据。一般两设备间传输数据的最大时钟频率是 33kHz，大多数 PS/2 设备工作在 10--20kHz。推荐值在 15kHz 左右，也就是说，CLOCK 高、低电平的持续时间都为 40us。每一数据帧包含 11—12 位，具体含义如下图示。</p>
<table>
<thead>
<tr>
<th>数据</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1个起始位</td>
<td>总是逻辑 0</td>
</tr>
<tr>
<td>8个数据位</td>
<td>(LSB)地位在前</td>
</tr>
<tr>
<td>1 个奇偶校验位</td>
<td>奇校验</td>
</tr>
<tr>
<td>1 个停止位</td>
<td>总是逻辑 1</td>
</tr>
<tr>
<td>1 个应答位</td>
<td>仅用在主机对设备的通信中</td>
</tr>
</tbody>
</table>
<p>PS/2 到主机的通信时序如下图所示。数据在 PS/2 时钟的下降沿读取，PS/2 的时钟频率为 10—16.7kHz。对于 PS/2 设备，一般来说从时钟脉冲的上升沿到一个数据转变的时间至少要有 5us；数据变化到下降沿的时间至少要有 5us，并且不大于 25us，这个时序非常重要应该严格遵循。主机可以再第 11 个时钟脉冲停止位之前把时钟线拉低，使设备放弃发送当前字节，当然这种情况比较少见。在停止位发送后设备在发送下个包前应该至少等待 50us，给主机时间做相应的处理。不主机处理接收到的字节时一般会抑制发送(主机在收到每个包时通常自动做这个)。在主机释放抑制后，设备至少应该在发送任何数据前等 50us。<br>
<img src="./snake/ps2-1.png" alt=""><br>
该程序中我们需要用到上下左右四个按键，对应ps2键盘的通码表进行代码编写。<br>
<img src="./snake/R.jpg" alt=""></p>
<h3 id="代码思路">代码思路： </h3>
<h4 id="11-输入输出信号">1.1 输入输出信号 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">ps2</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> rst<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> ps2_clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> ps2_data<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> data
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> clk_state<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> neg<span class="token punctuation">;</span> <span class="token comment">// 探测ps2_clk的负边沿</span>
    <span class="token keyword keyword-assign">assign</span> neg <span class="token operator">=</span> <span class="token operator">~</span>clk_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> clk_state<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> r_state<span class="token punctuation">;</span><span class="token comment">// 计时</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> r_data<span class="token punctuation">;</span> <span class="token comment">// 存储临时数据</span>
    <span class="token keyword keyword-reg">reg</span> f<span class="token punctuation">,</span>e<span class="token punctuation">;</span> <span class="token comment">//是否特殊数据</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-negedge">negedge</span> rst<span class="token punctuation">)</span> <span class="token comment">//初始化clk_state</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst<span class="token punctuation">)</span>
            clk_state <span class="token operator">&lt;=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span>
            clk_state <span class="token operator">&lt;=</span> <span class="token operator">{</span>clk_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ps2_clk<span class="token operator">}</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-negedge">negedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">//初始化数据</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            r_state <span class="token operator">&lt;=</span> <span class="token number">4'b0000</span><span class="token punctuation">;</span>
            r_data <span class="token operator">&lt;=</span> <span class="token number">8'b00000000</span><span class="token punctuation">;</span>
            f <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
            e <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
            data <span class="token operator">&lt;=</span> <span class="token number">9'b000000000</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>neg<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>  
            <span class="token function">if</span><span class="token punctuation">(</span>r_state <span class="token operator">&gt;</span> <span class="token number">4'b1001</span><span class="token punctuation">)</span> <span class="token comment">//读取完一整串数据后重置计时信号</span>
                r_state <span class="token operator">&lt;=</span><span class="token number">4'b0000</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
                <span class="token function">if</span><span class="token punctuation">(</span>r_state <span class="token operator">&lt;</span> <span class="token number">4'b1001</span><span class="token operator">&amp;&amp;</span>r_state<span class="token operator">&gt;</span><span class="token number">4'b0</span><span class="token punctuation">)</span>
                    r_data<span class="token punctuation">[</span>r_state<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;=</span> ps2_data<span class="token punctuation">;</span>  <span class="token comment">//存入ps2_data</span>
                r_state <span class="token operator">&lt;=</span> r_state <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>r_state<span class="token operator">==</span><span class="token number">4'b1010</span><span class="token operator">&amp;&amp;|</span>r_data<span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
            <span class="token function">if</span><span class="token punctuation">(</span>r_data <span class="token operator">==</span><span class="token number">8'hf0</span><span class="token punctuation">)</span> 
                f <span class="token operator">&lt;=</span><span class="token number">1'b1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>r_data <span class="token operator">==</span><span class="token number">8'he0</span><span class="token punctuation">)</span>
                e <span class="token operator">&lt;=</span><span class="token number">1'b1</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-else">else</span>
                <span class="token function">if</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>  <span class="token comment">//代表断码，重置信号</span>
                    data<span class="token operator">&lt;=</span><span class="token number">9'b0</span><span class="token punctuation">;</span>
                    f<span class="token operator">&lt;=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
                    e<span class="token operator">&lt;=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-end">end</span>
                <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span> <span class="token comment">//在data头部输入1代表已经接受e信号</span>
                    e<span class="token operator">&lt;=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
                    data <span class="token operator">&lt;={</span><span class="token number">1'b1</span><span class="token punctuation">,</span>r_data<span class="token operator">}</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-end">end</span>
                <span class="token keyword keyword-else">else</span>
                    data <span class="token operator">&lt;=</span> <span class="token operator">{</span><span class="token number">1'b0</span><span class="token punctuation">,</span>r_data<span class="token operator">}</span><span class="token punctuation">;</span>
            r_data <span class="token operator">&lt;=</span> <span class="token number">8'b00000000</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h4 id="12-转化为方向信息以及实现键盘防抖动">1.2 转化为方向信息以及实现键盘防抖动 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token comment">//防抖动以及输出上下左右</span>
<span class="token keyword keyword-module">module</span> <span class="token function">ps2_dlc</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> rst<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> ps2_clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> ps2_data<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>dir <span class="token comment">//direction:00up;01down;10left;11right</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>data<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>all<span class="token punctuation">;</span> <span class="token comment">//[1:0]all 为11代表是up [3:2]代表down.....</span>
    ps2 <span class="token function">ps2</span><span class="token punctuation">(</span>
        <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ps2_clk</span><span class="token punctuation">(</span>ps2_clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">ps2_data</span><span class="token punctuation">(</span>ps2_data<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        all<span class="token operator">&lt;=</span><span class="token number">8'b00000000</span><span class="token punctuation">;</span>
        dir<span class="token operator">&lt;=</span><span class="token number">2'b11</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-negedge">negedge</span> rst<span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            all<span class="token operator">&lt;=</span><span class="token number">8'b00000000</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
            all<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;={</span>all<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token operator">==</span><span class="token number">9'h175</span><span class="token operator">}</span><span class="token punctuation">;</span> <span class="token comment">//防抖动，连续输入两次才可以读入信号</span>
            all<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&lt;={</span>all<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token operator">==</span><span class="token number">9'h172</span><span class="token operator">}</span><span class="token punctuation">;</span>
            all<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">&lt;={</span>all<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token operator">==</span><span class="token number">9'h16b</span><span class="token operator">}</span><span class="token punctuation">;</span>
            all<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">&lt;={</span>all<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>data<span class="token operator">==</span><span class="token number">9'h174</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-negedge">negedge</span> rst<span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        <span class="token function">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rst<span class="token punctuation">)</span>
            dir <span class="token operator">&lt;=</span><span class="token number">2'b11</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
            <span class="token function">case</span><span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token comment">//根据all数值输出方向信息</span>
            <span class="token number">8'b00000011</span><span class="token punctuation">:</span>dir<span class="token operator">&lt;=</span><span class="token number">2'b00</span><span class="token punctuation">;</span>
            <span class="token number">8'b00001100</span><span class="token punctuation">:</span>dir<span class="token operator">&lt;=</span><span class="token number">2'b01</span><span class="token punctuation">;</span>
            <span class="token number">8'b00110000</span><span class="token punctuation">:</span>dir<span class="token operator">&lt;=</span><span class="token number">2'b10</span><span class="token punctuation">;</span>
            <span class="token number">8'b11000000</span><span class="token punctuation">:</span>dir<span class="token operator">&lt;=</span><span class="token number">2'b11</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-endcase">endcase</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h2 id="2vga设计思路">2.VGA设计思路 </h2>
<h3 id="21-clk_gen模块">2.1 clk_gen模块 </h3>
<p>此模块产生 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>25</mn><mi>M</mi><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">25MHz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">25</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.04398em;">Hz</span></span></span></span> 的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>l</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">clk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 信号，用于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>G</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VGA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal">G</span><span class="mord mathnormal">A</span></span></span></span> 的运作。</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">clk_gen</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span> <span class="token comment">// 100 MHz</span>
    <span class="token keyword keyword-output">output</span> vga_clk <span class="token comment">// 25 MHz</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> clkdiv<span class="token punctuation">;</span>
    <span class="token keyword keyword-initial">initial</span> clkdiv <span class="token operator">=</span> <span class="token number">2'b0</span><span class="token punctuation">;</span>
    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> clkdiv <span class="token operator">=</span> clkdiv <span class="token operator">+</span> <span class="token number">2'b1</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-assign">assign</span> vga_clk <span class="token operator">=</span> clkdiv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h3 id="22-vga_ctrl模块">2.2 vga_ctrl模块 </h3>
<p>此模块已提供。接收像素点的色彩信息（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>i</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">Din</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">in</span></span></span></span>），输出当前像素点的坐标（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>o</mi><mi>w</mi><mo separator="true">,</mo><mi>c</mi><mi>o</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">row,col</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ro</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span>）和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>G</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">VGA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal">G</span><span class="mord mathnormal">A</span></span></span></span> 有关的变量（<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo separator="true">,</mo><mi>G</mi><mo separator="true">,</mo><mi>B</mi><mo separator="true">,</mo><mi>H</mi><mi>S</mi><mo separator="true">,</mo><mi>V</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">R,G,B,HS,VS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">G</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>）。</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">vga_ctrl</span><span class="token punctuation">(</span>
	<span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>                   <span class="token comment">// vga clk = 25 MHz</span>
	<span class="token keyword keyword-input">input</span> rst<span class="token punctuation">,</span>
	<span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>Din<span class="token punctuation">,</span>			<span class="token comment">// bbbb_gggg_rrrr, pixel</span>
	<span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>row<span class="token punctuation">,</span>		<span class="token comment">// pixel ram row address, 480 (512) lines</span>
	<span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>col<span class="token punctuation">,</span>		<span class="token comment">// pixel ram col address, 640 (1024) pixels</span>
	<span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> rdn<span class="token punctuation">,</span>			<span class="token comment">// read pixel RAM(active_low)</span>
	<span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>R<span class="token punctuation">,</span> G<span class="token punctuation">,</span> B<span class="token punctuation">,</span><span class="token comment">// red, green, blue colors</span>
	<span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> HS<span class="token punctuation">,</span> VS			<span class="token comment">// horizontal and vertical synchronization</span>
   <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// h_count: VGA horizontal counter (0~799)</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> h_count<span class="token punctuation">;</span> <span class="token comment">// VGA horizontal counter (0~799): pixels</span>
<span class="token keyword keyword-initial">initial</span> h_count <span class="token operator">=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
	<span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span>  h_count <span class="token operator">&lt;=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span>  <span class="token punctuation">(</span>h_count <span class="token operator">==</span> <span class="token number">10'd799</span><span class="token punctuation">)</span>
					 h_count <span class="token operator">&lt;=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
			  <span class="token keyword keyword-else">else</span> h_count <span class="token operator">&lt;=</span> h_count <span class="token operator">+</span> <span class="token number">10'h1</span><span class="token punctuation">;</span>
	<span class="token keyword keyword-end">end</span>

<span class="token comment">// v_count: VGA vertical counter (0~524)</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> v_count<span class="token punctuation">;</span> <span class="token comment">// VGA vertical counter (0~524): pixel</span>
<span class="token keyword keyword-initial">initial</span> v_count <span class="token operator">=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
	<span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
		<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span>  v_count <span class="token operator">&lt;=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span>  <span class="token punctuation">(</span>h_count <span class="token operator">==</span> <span class="token number">10'd799</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
					<span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>v_count <span class="token operator">==</span> <span class="token number">10'd524</span><span class="token punctuation">)</span> v_count <span class="token operator">&lt;=</span> <span class="token number">10'h0</span><span class="token punctuation">;</span>
					<span class="token keyword keyword-else">else</span> v_count <span class="token operator">&lt;=</span> v_count <span class="token operator">+</span> <span class="token number">10'h1</span><span class="token punctuation">;</span>
		<span class="token keyword keyword-end">end</span>
	<span class="token keyword keyword-end">end</span>
	

<span class="token comment">// signals, will be latched for outputs</span>
<span class="token keyword keyword-wire">wire</span>	<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> row_addr <span class="token operator">=</span> v_count <span class="token operator">-</span> <span class="token number">10'd35</span><span class="token punctuation">;</span>		<span class="token comment">// pixel ram row addr</span>
<span class="token keyword keyword-wire">wire</span>	<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> col_addr <span class="token operator">=</span> h_count <span class="token operator">-</span> <span class="token number">10'd143</span><span class="token punctuation">;</span>		<span class="token comment">// pixel ram col addr</span>
<span class="token keyword keyword-wire">wire</span>			h_sync <span class="token operator">=</span> <span class="token punctuation">(</span>h_count <span class="token operator">&gt;</span> <span class="token number">10'd95</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//   96 -&gt; 799</span>
<span class="token keyword keyword-wire">wire</span>			v_sync <span class="token operator">=</span> <span class="token punctuation">(</span>v_count <span class="token operator">&gt;</span> <span class="token number">10'd1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//    2 -&gt; 524</span>
<span class="token keyword keyword-wire">wire</span>			read   <span class="token operator">=</span> <span class="token punctuation">(</span>h_count <span class="token operator">&gt;</span> <span class="token number">10'd142</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>	<span class="token comment">//  143 -&gt; 782</span>
							<span class="token punctuation">(</span>h_count <span class="token operator">&lt;</span> <span class="token number">10'd783</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>	<span class="token comment">//         640 pixels</span>
							<span class="token punctuation">(</span>v_count <span class="token operator">&gt;</span> <span class="token number">10'd34</span><span class="token punctuation">)</span>  <span class="token operator">&amp;&amp;</span>	<span class="token comment">//   35 -&gt; 514</span>
							<span class="token punctuation">(</span>v_count <span class="token operator">&lt;</span> <span class="token number">10'd525</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//         480 lines</span>
<span class="token comment">// vga signals</span>
<span class="token important">always @</span> <span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
	row <span class="token operator">&lt;=</span> row_addr<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">// pixel ram row address</span>
	col <span class="token operator">&lt;=</span> col_addr<span class="token punctuation">;</span>			<span class="token comment">// pixel ram col address</span>
	rdn <span class="token operator">&lt;=</span> <span class="token operator">~</span>read<span class="token punctuation">;</span>				<span class="token comment">// read pixel (active low)</span>
	HS  <span class="token operator">&lt;=</span> h_sync<span class="token punctuation">;</span>				<span class="token comment">// horizontal synchronization</span>
	VS  <span class="token operator">&lt;=</span> v_sync<span class="token punctuation">;</span>				<span class="token comment">// vertical   synchronization</span>
	R   <span class="token operator">&lt;=</span> rdn <span class="token operator">?</span> <span class="token number">4'h0</span> <span class="token punctuation">:</span> Din<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">// 3-bit red</span>
	G	 <span class="token operator">&lt;=</span> rdn <span class="token operator">?</span> <span class="token number">4'h0</span> <span class="token punctuation">:</span> Din<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">// 3-bit green</span>
	B	 <span class="token operator">&lt;=</span> rdn <span class="token operator">?</span> <span class="token number">4'h0</span> <span class="token punctuation">:</span> Din<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">// 2-bit blue</span>
<span class="token keyword keyword-end">end</span>

<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h3 id="23-vga_screen_pic模块">2.3 vga_screen_pic模块 </h3>
<p>核心模块，输出当前像素点的色彩信息并提供给 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>g</mi><mi>a</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>t</mi><mi>r</mi><mi>l</mi></mrow><annotation encoding="application/x-tex">vga\_ctrl</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">vg</span><span class="mord mathnormal">a</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span></span> 模块。</p>
<h4 id="231-ip核的生成">2.3.1 IP核的生成 </h4>
<h5 id="图片制作">图片制作 </h5>
<p>部分图片是由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">AI</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span> 生成并使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>S</mi></mrow><annotation encoding="application/x-tex">PS</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PS</span></span></span></span> 进行一定处理后产生。</p>
<h6 id="游戏开始画面">游戏开始画面 </h6>
<p><img src="./vga_part/game_start.bmp" alt="game_start"></p>
<h6 id="游戏结束画面">游戏结束画面 </h6>
<p><img src="./vga_part/game_over.bmp" alt="game_over"></p>
<h6 id="游戏中画面">游戏中画面 </h6>
<p>蛇的身体：</p>
<p><img src="./vga_part/snake_body.bmp" alt="snake_body"></p>
<p>蛇的头部：</p>
<p><img src="./vga_part/snake_head.bmp" alt="snake_head"></p>
<p>死亡格：</p>
<p><img src="./vga_part/dead_block.bmp" alt="dead_block"></p>
<p>小食物：</p>
<p><img src="./vga_part/food_s.bmp" alt="food_s"></p>
<p>中食物：</p>
<p><img src="./vga_part/food_m.bmp" alt="food_m"></p>
<p>大食物：</p>
<p><img src="./vga_part/food_l.bmp" alt="food_l"></p>
<h5 id="图片处理">图片处理 </h5>
<p>所有图片导出为24位 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">.</mi><mi>b</mi><mi>m</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">.bmp</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord">.</span><span class="mord mathnormal">bm</span><span class="mord mathnormal">p</span></span></span></span> 文件，并使用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>a</mi><mi>t</mi><mi>l</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Matlab</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">tl</span><span class="mord mathnormal">ab</span></span></span></span> 将其转换为符合格式的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">.coe</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord">.</span><span class="mord mathnormal">coe</span></span></span></span> 文件。</p>
<p>转换函数如下：</p>
<pre data-role="codeBlock" data-info="matlab" class="language-matlab matlab"><code><span class="token keyword keyword-function">function</span> <span class="token function">img2coe</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token comment">% 利用imread函数把图片转化为一个三维矩阵</span>
    image_array <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">% 利用size函数把图片矩阵的三个维度大小计算出来</span>
    <span class="token comment">% 第一维为图片的高度，第二维为图片的宽度，第三维为图片的RGB分量</span>
    <span class="token punctuation">[</span>height<span class="token punctuation">,</span>width<span class="token punctuation">,</span>z<span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">size</span><span class="token punctuation">(</span>image_array<span class="token punctuation">)</span><span class="token punctuation">;</span>   

    red   <span class="token operator">=</span> <span class="token function">image_array</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% 提取红色分量，数据类型为uint8</span>
    green <span class="token operator">=</span> <span class="token function">image_array</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% 提取绿色分量，数据类型为uint8</span>
    blue  <span class="token operator">=</span> <span class="token function">image_array</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% 提取蓝色分量，数据类型为uint8</span>

    <span class="token comment">% 把上面得到了各个分量重组成一个1维矩阵，由于reshape函数重组矩阵的</span>
    <span class="token comment">% 时候是按照列进行重组的，所以重组前需要先把各个分量矩阵进行转置以后再重组</span>
    <span class="token comment">% 利用reshape重组完毕以后，由于后面需要对数据拼接，所以为了避免溢出</span>
    <span class="token comment">% 这里把uint8类型的数据扩大为uint32类型</span>
    r <span class="token operator">=</span> <span class="token function">uint32</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>red<span class="token operator">'</span>   <span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">,</span>height<span class="token operator">*</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    g <span class="token operator">=</span> <span class="token function">uint32</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>green<span class="token operator">'</span> <span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">,</span>height<span class="token operator">*</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    b <span class="token operator">=</span> <span class="token function">uint32</span><span class="token punctuation">(</span><span class="token function">reshape</span><span class="token punctuation">(</span>blue<span class="token operator">'</span>  <span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">,</span>height<span class="token operator">*</span>width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% 初始化要写入.coe文件中的RGB颜色矩阵</span>
    rgb<span class="token operator">=</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>height<span class="token operator">*</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% 因为导入的图片是24-bit真彩色图片，每个像素占用24-bit，其中RGB分别占用8-bit</span>
    <span class="token comment">% 而我这里需要的是12-bit，其中R为4-bit，G为4-bit，B为4-bit，所以需要在这里对24-bit的数据进行重组与拼接</span>
    <span class="token comment">% bitshift()函数的作用是对数据进行移位操作，其中第一个参数是要进行移位的数据，第二个参数为负数表示向右移，为</span>
    <span class="token comment">% 正数表示向左移，更详细的用法直接在Matlab命令窗口输入 doc bitshift 进行查看</span>
    <span class="token comment">% 所以这里对红色分量先右移4位取出高4位，然后左移8位作为ROM中RGB数据的第11-bit到第8-bit</span>
    <span class="token comment">% 对绿色分量先右移4位取出高4位，然后左移4位作为ROM中RGB数据的第7-bit到第4-bit</span>
    <span class="token comment">% 对蓝色分量先右移4位取出高4位，然后左移0位作为ROM中RGB数据的第3-bit到第0-bit</span>
    <span class="token keyword keyword-for">for</span> <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span>height<span class="token operator">*</span>width
        <span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">g</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">bitshift</span><span class="token punctuation">(</span><span class="token function">b</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    fid <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span> name <span class="token punctuation">,</span> <span class="token string">'w+'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% .coe文件的最前面一行必须为这个字符串，其中16表示16进制</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span> fid<span class="token punctuation">,</span> <span class="token string">'memory_initialization_radix=16;\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% .coe文件的第二行必须为这个字符串</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span> fid<span class="token punctuation">,</span> <span class="token string">'memory_initialization_vector =\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% 把rgb数据的前 height*width-1  个数据写入.coe文件中，每个数据之间用逗号隔开</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span> fid<span class="token punctuation">,</span> <span class="token string">'%x,\n'</span><span class="token punctuation">,</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token keyword keyword-end">end</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">% 把rgb数据的最后一个数据写入.coe文件中，并用分号结尾</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span> fid<span class="token punctuation">,</span> <span class="token string">'%x;'</span><span class="token punctuation">,</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token keyword keyword-end">end</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fclose</span><span class="token punctuation">(</span> fid <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">% 关闭文件指针</span>
<span class="token keyword keyword-end">end</span>

</code></pre><p>生成后的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">.coe</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord">.</span><span class="mord mathnormal">coe</span></span></span></span> 文件格式如下：</p>
<pre data-role="codeBlock" data-info=".coe" class="language-.coe .coe"><code>memory_initialization_radix=16; // 表示每一行的数据是16进制的
memory_initialization_vector =
5c5, // 每一行都是一个像素点的色彩信息，R，G，B三个通道各4bit
5c5,
5c5,
...
5c5,
5c5,
5c5;
</code></pre><h5 id="生成ip核">生成IP核 </h5>
<p>利用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>d</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">vivado</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span></span></span></span> 生成IP核，导入 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">.coe</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord">.</span><span class="mord mathnormal">coe</span></span></span></span> 文件，选择生成 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>O</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">ROM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">ROM</span></span></span></span> 。</p>
<h4 id="ip核的调用">IP核的调用 </h4>
<p>模块接口以及变量定义与初始化：</p>
<p>需要说明的是，输入变量 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">state</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span> 由 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>u</mi><mi>n</mi><mi mathvariant="normal">_</mi><mi>m</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>l</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">run\_module</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span></span></span></span> 模块根据当前像素点坐标得到并提供。</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">vga_screen_pic</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_x<span class="token punctuation">,</span> <span class="token comment">// 像素点 x 坐标</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_y<span class="token punctuation">,</span> <span class="token comment">// 像素点 y 坐标</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span> <span class="token comment">// 100 MHz</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state<span class="token punctuation">,</span> <span class="token comment">// 游戏状态</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">,</span> <span class="token comment">// 当前单元格的状态</span>
    <span class="token comment">// 0 背景 1 蛇头 2 蛇身 3 小食物 4 中食物 5 大食物 6 死亡格</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_data_out <span class="token comment">// 色彩信息</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-parameter">parameter</span> H_PIC <span class="token operator">=</span> <span class="token number">10'd16</span><span class="token punctuation">,</span> <span class="token comment">// 小图片高度</span>
            SCREEN_W_PIC <span class="token operator">=</span> <span class="token number">19'd640</span><span class="token punctuation">;</span> <span class="token comment">// VGA 宽度</span>

    <span class="token keyword keyword-parameter">parameter</span> BLACK <span class="token operator">=</span> <span class="token number">12'h000</span><span class="token punctuation">,</span> <span class="token comment">// 背景</span>
            GREEN <span class="token operator">=</span> <span class="token number">12'h0f0</span><span class="token punctuation">,</span> <span class="token comment">// 蛇头（暂时替代）</span>
            YELLOW <span class="token operator">=</span> <span class="token number">12'hff0</span><span class="token punctuation">,</span> <span class="token comment">// 蛇身（暂时替代）</span>
            RED <span class="token operator">=</span> <span class="token number">12'hf00</span><span class="token punctuation">,</span> <span class="token comment">// 死亡格（暂时替代）</span>
            BLUE <span class="token operator">=</span> <span class="token number">12'h00f</span><span class="token punctuation">;</span> <span class="token comment">// 食物（暂时替代）</span>
    
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pic_romaddr0<span class="token punctuation">;</span> <span class="token comment">// 小图片的 ROM 地址</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pic_romaddr1<span class="token punctuation">;</span> <span class="token comment">// 大图片的 ROM 地址</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> snake_head_data<span class="token punctuation">,</span> snake_body_data<span class="token punctuation">,</span> 
                food_s_data<span class="token punctuation">,</span> food_m_data<span class="token punctuation">,</span> food_l_data<span class="token punctuation">,</span>
                dead_block_data<span class="token punctuation">,</span> game_start_data<span class="token punctuation">,</span> game_over_data<span class="token punctuation">;</span> <span class="token comment">// 各个 ROM 里的数据信息</span>
</code></pre><p>定义了两个函数，用于计算当前像素点所在的单元格的左上角坐标，便于计算相应的地址信息从而获得相应的色彩信息。</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_x<span class="token punctuation">;</span> <span class="token comment">// 计算像素点对应单元格的左上角 x 坐标</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_x<span class="token punctuation">;</span>
    <span class="token keyword keyword-begin">begin</span>
        cell_x <span class="token operator">=</span> <span class="token punctuation">(</span>pix_x <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> H_PIC<span class="token punctuation">;</span> <span class="token comment">// 除以 16 并乘以图片的高度</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endfunction">endfunction</span>

<span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_y<span class="token punctuation">;</span> <span class="token comment">// 计算像素点对应单元格的左上角 y 坐标</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_y<span class="token punctuation">;</span>
    <span class="token keyword keyword-begin">begin</span>
        cell_y <span class="token operator">=</span> <span class="token punctuation">(</span>pix_y <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> H_PIC<span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endfunction">endfunction</span>
</code></pre><p>计算两个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>O</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">ROM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">ROM</span></span></span></span> 地址变量的值：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-assign">assign</span> pic_romaddr0 <span class="token operator">=</span> <span class="token punctuation">(</span>pix_x <span class="token operator">-</span> <span class="token function">cell_x</span><span class="token punctuation">(</span>pix_x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>pix_y <span class="token operator">-</span> <span class="token function">cell_y</span><span class="token punctuation">(</span>pix_y<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> H_PIC<span class="token punctuation">;</span>
<span class="token keyword keyword-assign">assign</span> pic_romaddr1 <span class="token operator">=</span> pix_x <span class="token operator">+</span> pix_y <span class="token operator">*</span> SCREEN_W_PIC<span class="token punctuation">;</span> <span class="token comment">// 大图片的宽度和 VGA 的宽度相同</span>
</code></pre><p>IP核的调用：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code>snake_head <span class="token function">snake_head0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>snake_head_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

snake_body <span class="token function">snake_body0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>snake_body_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

food_s <span class="token function">food_s0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>food_s_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

food_m <span class="token function">food_m0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>food_m_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

food_l <span class="token function">food_l0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>food_l_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

dead_block <span class="token function">dead_block0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr0<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>dead_block_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

game_start <span class="token function">game_start0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr1<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>game_start_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

game_over <span class="token function">game_over0</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">addra</span><span class="token punctuation">(</span>pic_romaddr1<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clka</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">douta</span><span class="token punctuation">(</span>game_over_data<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>计算正确的色彩信息：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span>game_state<span class="token punctuation">)</span> <span class="token comment">// 判断游戏状态</span>
        <span class="token number">2'd0</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> game_start_data<span class="token punctuation">;</span> <span class="token comment">// 0 即游戏待开始，色彩信息为 game_start 图片</span>
        <span class="token number">2'd1</span><span class="token punctuation">:</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 1 即游戏进行中</span>
            <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token comment">// 判断单元格的状态</span>
                <span class="token number">3'd0</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> BLACK<span class="token punctuation">;</span> <span class="token comment">// 0 即背景格，为黑色</span>
                <span class="token number">3'd1</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> snake_head_data<span class="token punctuation">;</span> <span class="token comment">// 1 即蛇头部</span>
                <span class="token number">3'd2</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> snake_body_data<span class="token punctuation">;</span> <span class="token comment">// 2 即蛇身部</span>
                <span class="token number">3'd3</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> food_s_data<span class="token punctuation">;</span> <span class="token comment">// 3 即小食物</span>
                <span class="token number">3'd4</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> food_m_data<span class="token punctuation">;</span> <span class="token comment">// 4 即中食物</span>
                <span class="token number">3'd5</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> food_l_data<span class="token punctuation">;</span> <span class="token comment">// 5 即大食物</span>
                <span class="token number">3'd6</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> dead_block_data<span class="token punctuation">;</span> <span class="token comment">// 6 即死亡格</span>
                <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> BLACK<span class="token punctuation">;</span> <span class="token comment">// 其他状态设置为黑色</span>
            <span class="token keyword keyword-endcase">endcase</span>
        <span class="token keyword keyword-end">end</span>
        <span class="token number">2'd2</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> game_over_data<span class="token punctuation">;</span> <span class="token comment">// 2 即游戏结束 </span>
        <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span> pix_data_out <span class="token operator">&lt;=</span> BLACK<span class="token punctuation">;</span> <span class="token comment">// 其他状态设置为黑色</span>
    <span class="token keyword keyword-endcase">endcase</span>
<span class="token keyword keyword-end">end</span>
</code></pre><h2 id="3蜂鸣器设计思路">3.蜂鸣器设计思路 </h2>
<h3 id="蜂鸣器原理">蜂鸣器原理 </h3>
<p>我们板子的蜂鸣器是无源蜂鸣器，因其内部不带震荡源，所以需要PWM方波才能驱动其发声。</p>
<p>PWM方波的频率决定声音的音调，PWM方波的占空比决定声音的响度。所以只需产生不同频率和占空比的PWM方波去驱动无源蜂鸣器，就能让无源蜂鸣器发出想要的声音序列了。</p>
<h3 id="实现步骤">实现步骤 </h3>
<h4 id="游戏开始音乐">游戏开始音乐 </h4>
<p>选择合适的音乐，扒谱：</p>
<p><img src="./beep_part/game_start.png" alt="game_start"></p>
<p>实现原理波形图如下：</p>
<p><img src="./beep_part/pic1.png" alt="pic1"></p>
<p>我们的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>l</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">clk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 频率为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>100</mn><mi>M</mi><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">100MHz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">100</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.04398em;">Hz</span></span></span></span> ，周期为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>10</mn><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">10ns</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">10</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span> ，该音乐的bpm为120，每过半拍（8个16分音符），时间过去1s。以一个16分音符的长度为单位时间，即 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>8</mn></mfrac><mo>=</mo><mn>0.125</mn><mi>s</mi><mo>=</mo><mn>125</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\frac{1}{8}=0.125s=125ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.125</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">125</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span> ，包括了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>0.125</mn><mrow><mn>10</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>9</mn></mrow></msup></mrow></mfrac><mo>=</mo><mn>12500000</mn></mrow><annotation encoding="application/x-tex">\frac{0.125}{10\times10^{-9}}=12500000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2484em;vertical-align:-0.4033em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span><span class="mbin mtight">×</span><span class="mord mtight">1</span><span class="mord mtight"><span class="mord mtight">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">9</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0.125</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">12500000</span></span></span></span> 个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>l</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">clk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 周期。以 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">A4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord">4</span></span></span></span> 音为例，该音调的频率为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>440</mn><mi>H</mi><mi>z</mi></mrow><annotation encoding="application/x-tex">440Hz</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">440</span><span class="mord mathnormal" style="margin-right:0.04398em;">Hz</span></span></span></span> ，其音波周期为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>440</mn></mfrac><mo>=</mo><mn>2272727</mn><mi>n</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">\frac{1}{440} = 2272727ns</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">440</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2272727</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span></span></span></span> ，包括了 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>2272727</mn><mn>10</mn></mfrac><mo>=</mo><mn>2272723</mn></mrow><annotation encoding="application/x-tex">\frac{2272727}{10}=2272723</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1901em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2272727</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2272723</span></span></span></span> 个 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>l</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">clk</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> 周期。其他音同理。</p>
<p>接下来将结合实现原理波形图和代码进行详细解释。</p>
<p>模块接口和变量的定义和初始化：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">beep_gamestart</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state<span class="token punctuation">,</span> <span class="token comment">// 游戏状态变量</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> beep
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-reg">reg</span> rst<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span> <span class="token comment">// 用于计数的信号</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> freq_cnt<span class="token punctuation">;</span> <span class="token comment">// 音调频率计数</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt_125ms<span class="token punctuation">;</span> <span class="token comment">// 125ms个数计数</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> freq_data<span class="token punctuation">;</span> <span class="token comment">// 音调频率</span>

    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> duty_data<span class="token punctuation">;</span> <span class="token comment">// 占空比</span>
    
    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 初始化所有 reg 信号</span>
        rst <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        beep <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
        cnt <span class="token operator">=</span> <span class="token number">24'b0</span><span class="token punctuation">;</span>
        freq_cnt <span class="token operator">=</span> <span class="token number">20'b0</span><span class="token punctuation">;</span>
        cnt_125ms <span class="token operator">=</span> <span class="token number">6'b0</span><span class="token punctuation">;</span>
        freq_data <span class="token operator">=</span> <span class="token number">20'b0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    
    <span class="token keyword keyword-parameter">parameter</span> TIME_125ms <span class="token operator">=</span> <span class="token number">24'd12499999</span><span class="token punctuation">,</span> <span class="token comment">// 125 ms</span>
                A4 <span class="token operator">=</span> <span class="token number">19'd227272</span><span class="token punctuation">,</span> <span class="token comment">// 440 Hz</span>
                D5 <span class="token operator">=</span> <span class="token number">19'd170357</span><span class="token punctuation">,</span> <span class="token comment">// 587</span>
                C5 <span class="token operator">=</span> <span class="token number">19'd191204</span><span class="token punctuation">,</span> <span class="token comment">// 523</span>
                B4 <span class="token operator">=</span> <span class="token number">19'd202428</span><span class="token punctuation">,</span> <span class="token comment">// 494</span>
                FS_4 <span class="token operator">=</span> <span class="token number">19'd270269</span><span class="token punctuation">,</span> <span class="token comment">// 370</span>
                G4 <span class="token operator">=</span> <span class="token number">19'd255101</span><span class="token punctuation">,</span> <span class="token comment">// 392</span>
                D4 <span class="token operator">=</span> <span class="token number">19'd378787</span><span class="token punctuation">,</span> <span class="token comment">// 264</span>
                E4 <span class="token operator">=</span> <span class="token number">19'd303030</span><span class="token punctuation">,</span> <span class="token comment">// 330</span>
                F4 <span class="token operator">=</span> <span class="token number">19'd286532</span><span class="token punctuation">,</span> <span class="token comment">// 349</span>
                C4 <span class="token operator">=</span> <span class="token number">19'd381678</span><span class="token punctuation">;</span> <span class="token comment">// 262</span>
</code></pre><p>我们选择占空比为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>50</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">50\%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">50%</span></span></span></span> 的PWM方波：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-assign">assign</span> duty_data <span class="token operator">=</span> freq_data <span class="token operator">&gt;&gt;</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
</code></pre><p>根据游戏状态信号调整 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">rst</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">rs</span><span class="mord mathnormal">t</span></span></span></span> 信号：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span>game_state<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_state <span class="token operator">==</span> <span class="token number">2'b00</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 游戏开始页面</span>
        rst <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span> <span class="token comment">// rst 为 0 时，声波正常产生</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        rst <span class="token operator">=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span> <span class="token comment">// rst 为 1 时，声波不产生</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cnt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span> 的调整：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        cnt <span class="token operator">&lt;=</span> <span class="token number">24'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">==</span> TIME_125ms<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 每当 cnt 达到 TIME_125ms 即每过 1 个时间单位，该变量重置为 0 重新开始计数</span>
        cnt <span class="token operator">&lt;=</span> <span class="token number">24'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        cnt <span class="token operator">&lt;=</span> cnt <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic2.png" alt="pic2"></p>
<p><em><strong>注：testbench文件中修改了某些参数的值，以此来减少仿真时间</strong></em></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mn>125</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">cnt\_125ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">_125</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span> 的调整：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        cnt_125ms <span class="token operator">&lt;=</span> <span class="token number">6'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">==</span> TIME_125ms <span class="token operator">&amp;&amp;</span> cnt_125ms <span class="token operator">==</span> <span class="token number">7'd64</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 音乐播放结束时，重置为 0 ，实现循环播放音乐</span>
        cnt_125ms <span class="token operator">&lt;=</span> <span class="token number">6'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">==</span> TIME_125ms<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 每过 1 个时间单位，变量值加 1</span>
        cnt_125ms <span class="token operator">&lt;=</span> cnt_125ms <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic3.png" alt="pic3"></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>r</mi><mi>e</mi><mi>q</mi><mi mathvariant="normal">_</mi><mi>c</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">freq\_cnt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span> 的调整：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        freq_cnt <span class="token operator">&lt;=</span> <span class="token number">19'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>freq_cnt <span class="token operator">&gt;=</span> freq_data <span class="token operator">||</span> cnt <span class="token operator">==</span> TIME_125ms<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 当频率计数信号大于此时的声音频率，或每当过 1 个时间单位时，该值重置为 0 </span>
        freq_cnt <span class="token operator">&lt;=</span> <span class="token number">19'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        freq_cnt <span class="token operator">&lt;=</span> freq_cnt <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic4.png" alt="pic4"></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>e</mi><mi>e</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">beep</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">ee</span><span class="mord mathnormal">p</span></span></span></span> 的调整：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        beep <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>freq_cnt <span class="token operator">&gt;</span> duty_data<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 当频率计数信号大于占空比时，使 PWM 为 1，实现 50% 的占空比</span>
        beep <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        beep <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic5.png" alt="pic5"></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mi>r</mi><mi>e</mi><mi>q</mi><mi mathvariant="normal">_</mi><mi>d</mi><mi>a</mi><mi>t</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">freq\_data</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal">d</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span></span></span></span> 的调整：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        freq_data <span class="token operator">&lt;=</span> <span class="token number">19'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span>cnt_125ms<span class="token punctuation">)</span> <span class="token comment">// 根据不同的时间段，为该变量赋值不同的频率值</span>
            <span class="token number">7'd0</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd1</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd2</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd3</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd4</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D5<span class="token punctuation">;</span>
            <span class="token number">7'd5</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D5<span class="token punctuation">;</span>
            <span class="token number">7'd6</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd7</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd8</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C5<span class="token punctuation">;</span>
            <span class="token number">7'd9</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C5<span class="token punctuation">;</span>
            <span class="token number">7'd10</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C5<span class="token punctuation">;</span>
            <span class="token number">7'd11</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C5<span class="token punctuation">;</span>
            <span class="token number">7'd12</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> B4<span class="token punctuation">;</span>
            <span class="token number">7'd13</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd14</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> FS_4<span class="token punctuation">;</span>
            <span class="token number">7'd15</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">7'd16</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd17</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd18</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd19</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd20</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd21</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd22</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd23</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">7'd24</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd25</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd26</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd27</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd28</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd29</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd30</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd31</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd32</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd33</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd34</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd35</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd36</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd37</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd38</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd39</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd40</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd41</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd42</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd43</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd44</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd45</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">7'd46</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> F4<span class="token punctuation">;</span>
            <span class="token number">7'd47</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">7'd48</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd49</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd50</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd51</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> E4<span class="token punctuation">;</span>
            <span class="token number">7'd52</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C4<span class="token punctuation">;</span>
            <span class="token number">7'd53</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C4<span class="token punctuation">;</span>
            <span class="token number">7'd54</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C4<span class="token punctuation">;</span>
            <span class="token number">7'd55</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> C4<span class="token punctuation">;</span>
            <span class="token number">7'd56</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd57</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd58</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd59</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd60</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd61</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd62</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token number">7'd63</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> D4<span class="token punctuation">;</span>
            <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">19'd0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-endcase">endcase</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic6.png" alt="pic6"></p>
<h4 id="游戏结束音乐">游戏结束音乐 </h4>
<p><img src="./beep_part/game_over.png" alt="game_over"></p>
<p>和游戏开始音乐的实现相同，不同的点在于游戏结束音乐只需要播放一次。可以调整 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>n</mi><mi>t</mi><mi mathvariant="normal">_</mi><mn>125</mn><mi>m</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">cnt\_125ms</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9544em;vertical-align:-0.31em;"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord">_125</span><span class="mord mathnormal">m</span><span class="mord mathnormal">s</span></span></span></span> 实现播放一次。</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        cnt_125ms <span class="token operator">&lt;=</span> <span class="token number">6'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cnt <span class="token operator">==</span> TIME_125ms <span class="token operator">&amp;&amp;</span> cnt_125ms <span class="token operator">&lt;=</span> <span class="token number">6'd33</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        cnt_125ms <span class="token operator">&lt;=</span> cnt_125ms <span class="token operator">+</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token comment">// 当音乐播放结束后，不再重置为 0，实现只播放一次</span>
<span class="token keyword keyword-end">end</span>
</code></pre><pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>rst<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span>cnt_125ms<span class="token punctuation">)</span>
            <span class="token number">5'd0</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
            <span class="token number">5'd1</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
            <span class="token number">5'd2</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
            <span class="token number">5'd3</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
            <span class="token number">5'd4</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> AS_4<span class="token punctuation">;</span>
            <span class="token number">5'd5</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> AS_4<span class="token punctuation">;</span>
            <span class="token number">5'd6</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> AS_4<span class="token punctuation">;</span>
            <span class="token number">5'd7</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> AS_4<span class="token punctuation">;</span>
            <span class="token number">5'd10</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">5'd11</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">5'd12</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">5'd13</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> A4<span class="token punctuation">;</span>
            <span class="token number">5'd16</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> GS_4<span class="token punctuation">;</span>
            <span class="token number">5'd17</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> GS_4<span class="token punctuation">;</span>
            <span class="token number">5'd18</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> GS_4<span class="token punctuation">;</span>
            <span class="token number">5'd22</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd23</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd24</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd25</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd26</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd27</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd28</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd29</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd30</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd31</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd32</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token number">5'd33</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> G4<span class="token punctuation">;</span>
            <span class="token keyword keyword-default">default</span><span class="token punctuation">:</span> freq_data <span class="token operator">&lt;=</span> <span class="token number">18'd0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-endcase">endcase</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p><img src="./beep_part/pic7.png" alt="pic7"></p>
<h4 id="top_beep-模块">top_beep 模块 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">top_beep</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> beep
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-wire">wire</span> beep_start<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> beep_over<span class="token punctuation">;</span>

    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        beep <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    beep_gamestart <span class="token function">bp_gs</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">game_state</span><span class="token punctuation">(</span>game_state<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">beep</span><span class="token punctuation">(</span>beep_start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用两个模块</span>
    beep_gameover <span class="token function">bp_go</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">game_state</span><span class="token punctuation">(</span>game_state<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">beep</span><span class="token punctuation">(</span>beep_over<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_state <span class="token operator">==</span> <span class="token number">2'b00</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            beep <span class="token operator">=</span> beep_start<span class="token punctuation">;</span> <span class="token comment">// 游戏待开始状态，beep 为 game_start </span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_state <span class="token operator">==</span> <span class="token number">2'b10</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            beep <span class="token operator">=</span> beep_over<span class="token punctuation">;</span> <span class="token comment">// 游戏结束状态，beep 为 game_over</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h2 id="4状态机设计思路">4.状态机设计思路 </h2>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> gaming <span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> rst<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> gameover<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> start_button<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
    game_state <span class="token operator">=</span> <span class="token number">2'd0</span><span class="token punctuation">;</span> <span class="token comment">//初始化为开始界面</span>
<span class="token keyword keyword-end">end</span>


<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-negedge">negedge</span> rst <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> gameover <span class="token keyword keyword-or">or</span> <span class="token keyword keyword-posedge">posedge</span> start_button<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token function">if</span><span class="token punctuation">(</span>rst <span class="token operator">==</span> <span class="token number">1'b0</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        game_state <span class="token operator">&lt;=</span> <span class="token number">2'd0</span><span class="token punctuation">;</span>
        
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>start_button <span class="token operator">==</span> <span class="token number">2'b1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        game_state <span class="token operator">&lt;=</span> <span class="token number">2'd1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-else">else</span> <span class="token function">if</span><span class="token punctuation">(</span>gameover <span class="token operator">==</span> <span class="token number">2'b1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        game_state <span class="token operator">&lt;=</span> <span class="token number">2'd2</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    
<span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><p>设定游戏有3个状态分别是：<br>
<code>2'b00</code>:开始界面状态；<code>2'b01</code>:游玩中；<code>2‘b10</code>:游戏结束<br>
游戏初始化为<strong>开始界面</strong>状态，在游戏开始按钮<code>start_button</code>置1时，会切换为<strong>游玩中</strong>状态；当游戏结束，从运动模块中传入的<code>gameover</code>信号置1，游戏进入<strong>结束</strong>状态；当再按下<code>start_button</code>时即可恢复游戏状态为<strong>游玩中</strong>，继续游戏。</p>
<h2 id="5运动模块设计思路">5.运动模块设计思路 </h2>
<h3 id="51-io信号代码">5.1 IO信号代码 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">run_module</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span> <span class="token comment">//100MHZ</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> dir<span class="token punctuation">,</span> <span class="token comment">//按下的运动方向</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state<span class="token punctuation">,</span> <span class="token comment">//游戏状态：0 开始界面， 1 游戏中， 2 结束界面</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cur_x<span class="token punctuation">,</span><span class="token comment">// VGA当前X坐标</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cur_y<span class="token punctuation">,</span> <span class="token comment">//  VGA当且Y坐标</span>
    <span class="token keyword keyword-output">output</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> one_state<span class="token punctuation">,</span><span class="token comment">//(X,Y)坐标对应</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> gameover<span class="token punctuation">,</span><span class="token comment">//传出游戏结束的信息</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> score<span class="token comment">//得分</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>在划分后的<strong>40*30</strong>的区域上进行蛇的移动，</p>
<ul>
<li>通过传入<strong>dir</strong>信号来控制蛇移动的方向，</li>
<li><strong>game_state</strong>来判断当前游戏状态，</li>
<li><strong>cur_x,cur_y,one_state</strong>来输出当前坐标所在单元格的状态信息，</li>
<li><strong>gameover</strong>传出游戏结束的信息，</li>
<li><strong>score</strong>传出当前的得分。</li>
</ul>
<h3 id="52-定义代码">5.2 定义代码 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-parameter">parameter</span> MAX_LENGTH <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword keyword-parameter">parameter</span> MAX_CNT <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> head_x<span class="token punctuation">;</span> 
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> head_y<span class="token punctuation">;</span> <span class="token comment">//蛇头的坐标</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> next_head_x<span class="token punctuation">;</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> next_head_y<span class="token punctuation">;</span> <span class="token comment">//下一刻蛇头的坐标</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fruit_x<span class="token punctuation">;</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> fruit_y<span class="token punctuation">;</span><span class="token comment">//食物坐标</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> body_x <span class="token punctuation">[</span>MAX_LENGTH<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> body_y <span class="token punctuation">[</span>MAX_LENGTH<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//存储蛇身坐标的数组</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> current_dir<span class="token punctuation">;</span><span class="token comment">//当前蛇运动的方向</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//所有单元的状态信息</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cnt<span class="token punctuation">;</span><span class="token comment">//计数以分频</span>
<span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state_pos<span class="token punctuation">;</span><span class="token comment">//存储上一刻和当前的游戏状态</span>
<span class="token keyword keyword-wire">wire</span> game_clk<span class="token punctuation">;</span><span class="token comment">//游戏频率（速度）</span>
<span class="token keyword keyword-integer">integer</span> length<span class="token punctuation">;</span>
<span class="token keyword keyword-integer">integer</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

<span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    cnt <span class="token operator">=</span> cnt <span class="token operator">+</span> <span class="token number">24'b1</span><span class="token punctuation">;</span>
<span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-assign">assign</span> game_clk<span class="token operator">=</span>cnt<span class="token punctuation">[</span>MAX_CNT<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">//计算转换后的对应单元格坐标</span>
<span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state_x_addr<span class="token punctuation">;</span> 
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_x<span class="token punctuation">;</span>
    <span class="token keyword keyword-begin">begin</span>
        state_x_addr  <span class="token operator">=</span> pix_x <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// x</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endfunction">endfunction</span>

<span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state_y_addr<span class="token punctuation">;</span> 
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_y<span class="token punctuation">;</span>
    <span class="token keyword keyword-begin">begin</span>
        state_y_addr <span class="token operator">=</span> pix_y <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// y</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endfunction">endfunction</span>

<span class="token keyword keyword-assign">assign</span> one_state <span class="token operator">=</span> state<span class="token punctuation">[</span><span class="token function">state_x_addr</span><span class="token punctuation">(</span>cur_x<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token function">state_y_addr</span><span class="token punctuation">(</span>cur_y<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre><h3 id="53-初始化">5.3 初始化 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
    cnt <span class="token operator">=</span> <span class="token number">24'b0</span><span class="token punctuation">;</span>
    state_pos <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span>
    head_x <span class="token operator">=</span> <span class="token number">6'd20</span><span class="token punctuation">;</span>
    head_y <span class="token operator">=</span> <span class="token number">5'd15</span><span class="token punctuation">;</span>
    next_head_x <span class="token operator">=</span> <span class="token number">6'd20</span><span class="token punctuation">;</span>
    next_head_y <span class="token operator">=</span> <span class="token number">5'd15</span><span class="token punctuation">;</span>
    <span class="token comment">//fruit_flag = 2'd0;</span>
    length <span class="token operator">=</span> <span class="token number">1'd1</span><span class="token punctuation">;</span>
    fruit_x <span class="token operator">=</span> <span class="token number">6'd25</span><span class="token punctuation">;</span>
    fruit_y <span class="token operator">=</span> <span class="token number">5'd15</span><span class="token punctuation">;</span>
    body_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6'd19</span><span class="token punctuation">;</span>
    body_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6'd15</span><span class="token punctuation">;</span>
    body_x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6'd18</span><span class="token punctuation">;</span>
    body_y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6'd15</span><span class="token punctuation">;</span>
    current_dir <span class="token operator">=</span> <span class="token number">2'd3</span><span class="token punctuation">;</span>
    score <span class="token operator">=</span> <span class="token number">16'd0</span><span class="token punctuation">;</span>
    gameover <span class="token operator">=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">40</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
            state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3'b000</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
    i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state = 6为死亡格</span>
    <span class="token keyword keyword-end">end</span>
    i<span class="token operator">=</span><span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">30</span><span class="token punctuation">;</span>j<span class="token operator">=</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state = 6为死亡格</span>
    <span class="token keyword keyword-end">end</span>
    j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">40</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state = 6为死亡格</span>
    <span class="token keyword keyword-end">end</span>
    j<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">40</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state = 6为死亡格</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        body_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">6'd0</span><span class="token punctuation">;</span>
        body_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5'd0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> 
    <span class="token comment">// 增加场内障碍物</span>
    i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">34</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">36</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    state<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>

    i <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    j <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>

    i <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>

    j <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">28</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">38</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>
    
    i <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">35</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    i <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">35</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">13</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">25</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    
    j <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">13</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    j <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token comment">// 设置蛇的位置</span>
    state<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span>
<span class="token keyword keyword-end">end</span>
</code></pre><ol>
<li>初始设定蛇头坐标(20,15);</li>
<li>拥有两个身子，坐标分别为(19,15)(18,15);</li>
<li>默认移动方向为右；</li>
<li>形成好所有障碍物位置(屏幕边缘一圈以及场内部分位置)</li>
</ol>
<h3 id="54-重置游戏">5.4 重置游戏 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token important">always @</span><span class="token punctuation">(</span><span class="token keyword keyword-posedge">posedge</span> game_clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1'b1</span> <span class="token operator">||</span> game_clk <span class="token operator">==</span> <span class="token number">1'b1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        state_pos <span class="token operator">&lt;=</span> <span class="token operator">{</span>state_pos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> game_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">;</span>
        <span class="token function">if</span><span class="token punctuation">(</span>state_pos <span class="token operator">==</span> <span class="token number">2'b01</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
            head_x <span class="token operator">&lt;=</span> <span class="token number">6'd20</span><span class="token punctuation">;</span>
            head_y <span class="token operator">&lt;=</span> <span class="token number">5'd6</span><span class="token punctuation">;</span>
            length <span class="token operator">&lt;=</span> <span class="token number">1'd1</span><span class="token punctuation">;</span>
            fruit_x <span class="token operator">&lt;=</span> <span class="token number">6'd29</span><span class="token punctuation">;</span>
            fruit_y <span class="token operator">&lt;=</span> <span class="token number">5'd6</span><span class="token punctuation">;</span>
            body_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">6'd19</span><span class="token punctuation">;</span>
            body_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">6'd6</span><span class="token punctuation">;</span>
            body_x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">6'd18</span><span class="token punctuation">;</span>
            body_y<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">6'd6</span><span class="token punctuation">;</span>
            current_dir <span class="token operator">&lt;=</span> <span class="token number">2'd3</span><span class="token punctuation">;</span>
            score <span class="token operator">&lt;=</span> <span class="token number">16'd0</span><span class="token punctuation">;</span>
            <span class="token comment">// cnt &lt;= 0;</span>
            gameover <span class="token operator">&lt;=</span> <span class="token number">1'b0</span><span class="token punctuation">;</span>
            
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                    state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span>  <span class="token number">3'b000</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-end">end</span>
            i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span>  <span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state  =  6为死</span>
            <span class="token keyword keyword-end">end</span>
            i <span class="token operator">=</span> <span class="token number">39</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span>  <span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state  =  6为死</span>
            <span class="token keyword keyword-end">end</span>
            j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span>  <span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state  =  6为死</span>
            <span class="token keyword keyword-end">end</span>
            j <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;=</span>  <span class="token number">3'b110</span><span class="token punctuation">;</span> <span class="token comment">//state  =  6为死</span>
            <span class="token keyword keyword-end">end</span>

            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
                body_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">6'd0</span><span class="token punctuation">;</span>
                body_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">5'd0</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            <span class="token comment">// 增加地图</span>
            i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">34</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">36</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
            state<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            state<span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>

            i <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            j <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>

            i <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>

            j <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">28</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            i <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">38</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>
            
            i <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span> 
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">35</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            i <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">35</span><span class="token punctuation">;</span> j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            j <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">13</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">25</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
            
            j <span class="token operator">=</span> <span class="token number">24</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">13</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">18</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>

            j <span class="token operator">=</span> <span class="token number">35</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">24</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
                state<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token number">3'b110</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token comment">// 设置蛇的位置</span>
            state<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span>
            state<span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span>
            state<span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span>
            state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span>

</code></pre><p><code>state_pos &lt;= {state_pos[0], game_state[0]};</code>，当game_state维持在1时，state_pos 稳定为 2'b11；每当game_state从0变化为1时，所有游戏数据会被重置，回到初始设置。</p>
<h3 id="55-蛇的运动">5.5 蛇的运动 </h3>
<p>通过蛇头控制蛇的运动，而蛇的运动类型主要分为三类，分别是移动到空白格、触碰到身体或障碍物、吃到食物；三种运动类型分别有对应的代码处理：</p>
<h4 id="551-方向控制">5.5.1 方向控制 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_clk<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>game_state<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token function">case</span><span class="token punctuation">(</span>current_dir<span class="token punctuation">)</span>
            <span class="token number">2'd0</span><span class="token punctuation">:</span><span class="token keyword keyword-begin">begin</span>
                next_head_x <span class="token operator">=</span> head_x<span class="token punctuation">;</span>
                next_head_y <span class="token operator">=</span> head_y <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//0 向上移动</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token number">2'd1</span><span class="token punctuation">:</span><span class="token keyword keyword-begin">begin</span>
                next_head_x <span class="token operator">=</span> head_x<span class="token punctuation">;</span>
                next_head_y <span class="token operator">=</span> head_y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//1 向下移动</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token number">2'd2</span><span class="token punctuation">:</span><span class="token keyword keyword-begin">begin</span>
                next_head_x <span class="token operator">=</span> head_x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
                next_head_y <span class="token operator">=</span> head_y<span class="token punctuation">;</span><span class="token comment">//2 向左移动</span>
            <span class="token keyword keyword-end">end</span>
            <span class="token number">2'd3</span><span class="token punctuation">:</span><span class="token keyword keyword-begin">begin</span>
                next_head_x <span class="token operator">=</span> head_x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                next_head_y <span class="token operator">=</span> head_y<span class="token punctuation">;</span><span class="token comment">//3 向右移动</span>
            <span class="token keyword keyword-end">end</span>
        <span class="token keyword keyword-endcase">endcase</span>

<span class="token function">case</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span>
    <span class="token number">2'd0</span><span class="token punctuation">:</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>current_dir <span class="token operator">!=</span> <span class="token number">2'd1</span><span class="token punctuation">)</span> current_dir <span class="token operator">&lt;=</span> <span class="token number">2'd0</span><span class="token punctuation">;</span>
    <span class="token number">2'd1</span><span class="token punctuation">:</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>current_dir <span class="token operator">!=</span> <span class="token number">2'd0</span><span class="token punctuation">)</span> current_dir <span class="token operator">&lt;=</span> <span class="token number">2'd1</span><span class="token punctuation">;</span>
    <span class="token number">2'd2</span><span class="token punctuation">:</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>current_dir <span class="token operator">!=</span> <span class="token number">2'd3</span><span class="token punctuation">)</span> current_dir <span class="token operator">&lt;=</span> <span class="token number">2'd2</span><span class="token punctuation">;</span>
    <span class="token number">2'd3</span><span class="token punctuation">:</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>current_dir <span class="token operator">!=</span> <span class="token number">2'd2</span><span class="token punctuation">)</span> current_dir <span class="token operator">&lt;=</span> <span class="token number">2'd3</span><span class="token punctuation">;</span>
<span class="token keyword keyword-endcase">endcase</span>
</code></pre><ul>
<li>处理<code>current_dir</code>信号，然后0-3分别映射上下左右控制下一刻蛇头位置；</li>
<li>处理传入的<code>dir</code>信号，来改变<code>current_dir</code>，同时<strong>防止按运动反方向瞬死情况</strong></li>
</ul>
<h4 id="552-触碰障碍或身体">5.5.2 触碰障碍或身体 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3'b110</span> <span class="token operator">||</span> state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3'b010</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    gameover <span class="token operator">&lt;=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
<span class="token keyword keyword-end">end</span>
</code></pre><p>判断下一时刻头所处位置的状态，<code>3'b110</code>和<code>3'b010</code>分别对应障碍格以及蛇身，再更改<code>gameover</code>信号为1，<code>gameover</code>传出到状态机模块后使得游戏状态进入<strong>结束态</strong>。</p>
<h4 id="553-移动到空白格">5.5.3 移动到空白格 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3'b000</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
    state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span> <span class="token comment">//下一格变为蛇头</span>
    state<span class="token punctuation">[</span>head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>head_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span><span class="token comment">//原蛇头处变为蛇身</span>
    state<span class="token punctuation">[</span>body_x<span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>body_y<span class="token punctuation">[</span>length<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b000</span><span class="token punctuation">;</span><span class="token comment">//</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> MAX_LENGTH<span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        body_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> body_x<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        body_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> body_y<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span> <span class="token comment">//挪动身体数组</span>
    body_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> head_x<span class="token punctuation">;</span>
    body_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> head_y<span class="token punctuation">;</span>
    head_x <span class="token operator">=</span> next_head_x<span class="token punctuation">;</span>
    head_y <span class="token operator">=</span> next_head_y<span class="token punctuation">;</span>
<span class="token keyword keyword-end">end</span> 
</code></pre><ol>
<li>首先判断蛇头下一刻移动到空白格(<code>3'b000</code>)</li>
<li>将对应格状态设置成<strong>蛇头(3'b001)</strong></li>
<li>原来蛇头的位置会变成<strong>蛇身(<code>3'b010</code>)</strong></li>
<li>挪动存储蛇身的数组元素，以更改索引和相对位置间的关系</li>
</ol>
<h4 id="554-吃到食物">5.5.4 吃到食物 </h4>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
    <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span>state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token number">3'b011</span><span class="token punctuation">:</span> score <span class="token operator">=</span> score <span class="token operator">+</span> <span class="token number">16'd1</span><span class="token punctuation">;</span>
        <span class="token number">3'b100</span><span class="token punctuation">:</span> score <span class="token operator">=</span> score <span class="token operator">+</span> <span class="token number">16'd2</span><span class="token punctuation">;</span>
        <span class="token number">3'b101</span><span class="token punctuation">:</span> score <span class="token operator">=</span> score <span class="token operator">+</span> <span class="token number">16'd3</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-endcase">endcase</span>
    length <span class="token operator">=</span> length <span class="token operator">+</span> <span class="token number">1'd1</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span>next_head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>next_head_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b001</span><span class="token punctuation">;</span>
    state<span class="token punctuation">[</span>head_x<span class="token punctuation">]</span><span class="token punctuation">[</span>head_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b010</span><span class="token punctuation">;</span>
    <span class="token function">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> MAX_LENGTH<span class="token punctuation">;</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token keyword keyword-begin">begin</span>
        body_x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> body_x<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        body_y<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> body_y<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    body_x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> head_x<span class="token punctuation">;</span>
    body_y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> head_y<span class="token punctuation">;</span>
    head_x <span class="token operator">=</span> next_head_x<span class="token punctuation">;</span>
    head_y <span class="token operator">=</span> next_head_y<span class="token punctuation">;</span>
    
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">40</span> <span class="token operator">&amp;&amp;</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">3'b000</span><span class="token punctuation">;</span> i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
        fruit_x <span class="token operator">=</span> <span class="token punctuation">(</span>fruit_x <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">40</span><span class="token punctuation">;</span>
        fruit_y <span class="token operator">=</span> <span class="token punctuation">(</span>fruit_y <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">30</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
            j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token comment">//通过在原食物位置周围线性搜索空白格的方法以生成新食物</span>
    <span class="token keyword keyword-case">case</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">6</span><span class="token punctuation">)</span>
        <span class="token number">3'd0</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span> <span class="token comment">//state  =  3为果</span>
        <span class="token number">3'd1</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span> 
        <span class="token number">3'd2</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b011</span><span class="token punctuation">;</span> <span class="token comment">//生成Small_Food的相对概率为1/2</span>
        <span class="token number">3'd3</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b100</span><span class="token punctuation">;</span> <span class="token comment">//state  =  5为果</span>
        <span class="token number">3'd4</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b100</span><span class="token punctuation">;</span> <span class="token comment">//生成Medium_Food的相对概率为1/3</span>
        <span class="token number">3'd5</span><span class="token punctuation">:</span> state<span class="token punctuation">[</span>fruit_x<span class="token punctuation">]</span><span class="token punctuation">[</span>fruit_y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3'b101</span><span class="token punctuation">;</span> <span class="token comment">//state  =  5为果,生成Large_Food的相对概率为1/6</span>
    <span class="token keyword keyword-endcase">endcase</span>

</code></pre><ol>
<li>判断下一时刻蛇头移动到的位置的状态，以获得不同的得分(<code>3'b011</code>为小果实，1分；<code>3'b100</code>为中果实，2分；<code>3'b101</code>为大果实，3分);</li>
<li>通过和移动到空白格时类似的方法来增长长度</li>
<li>通过在原食物位置周围线性搜索空白格的方法以生成新食物</li>
<li>最后随机确定果实的种类，并改变对应位置单元格状态</li>
</ol>
<h1 id="仿真与调试过程分析">仿真与调试过程分析 </h1>
<h2 id="1ps2">1.PS2 </h2>
<h3 id="上版功能验证">上版功能验证 </h3>
<p>将四个信号对应四个LED灯，上板结果如下：<br>
<img src="./snake/1.jpg" alt=""><br>
<img src="./snake/2.jpg" alt=""><br>
<img src="./snake/3.jpg" alt=""><br>
<img src="./snake/4.jpg" alt=""><br>
上班结果分析：成功读取四个按键的信号，PS2编写正确。</p>
<h2 id="2vga">2.VGA </h2>
<h3 id="仿真测试">仿真测试 </h3>
<p>由于单独测试该模块，写了一个临时的计算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">state</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span> 变量的模块用于测试：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">target_v</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_x<span class="token punctuation">,</span>
    <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_y<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_addr_x<span class="token punctuation">;</span> <span class="token comment">// 单元格 x 坐标</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_addr_y<span class="token punctuation">;</span> <span class="token comment">// 单元格 y 坐标</span>

    <span class="token keyword keyword-parameter">parameter</span> H_PIC <span class="token operator">=</span> <span class="token number">10'd16</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-assign">assign</span> cell_addr_x <span class="token operator">=</span> cell_x <span class="token operator">/</span> H_PIC<span class="token punctuation">;</span> <span class="token comment">// 计算单元格 x 坐标</span>
    <span class="token keyword keyword-assign">assign</span> cell_addr_y <span class="token operator">=</span> cell_y <span class="token operator">/</span> H_PIC<span class="token punctuation">;</span> <span class="token comment">// 计算单元格 y 坐标</span>

    <span class="token important">always @</span><span class="token punctuation">(</span>cell_x <span class="token keyword keyword-or">or</span> cell_y<span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span> <span class="token comment">// 设置相应的单元格状态</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd1</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd1</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd2</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd2</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd3</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd1</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd3</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd4</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd2</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd4</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd5</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd2</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd5</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cell_addr_x <span class="token operator">==</span> <span class="token number">6'd6</span> <span class="token operator">&amp;&amp;</span> cell_addr_y <span class="token operator">==</span> <span class="token number">5'd2</span><span class="token punctuation">)</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd6</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span> <span class="token keyword keyword-else">else</span> <span class="token keyword keyword-begin">begin</span>
            state <span class="token operator">=</span> <span class="token number">3'd0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><p>临时 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>o</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">top</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8095em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span></span></span></span> 模块：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">vga_top</span><span class="token punctuation">(</span>
    <span class="token keyword keyword-input">input</span> clk<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> R<span class="token punctuation">,</span> G<span class="token punctuation">,</span> B<span class="token punctuation">,</span>
    <span class="token keyword keyword-output">output</span> HS<span class="token punctuation">,</span> VS
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-wire">wire</span> vga_clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pixel<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_y<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_x<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> state<span class="token punctuation">;</span>

    <span class="token keyword keyword-parameter">parameter</span> game_state <span class="token operator">=</span> <span class="token number">2'b10</span><span class="token punctuation">;</span> <span class="token comment">// 将 game_state 变量设置为参数，便于在testbench文件中修改</span>
    <span class="token keyword keyword-parameter">parameter</span> H_PIC <span class="token operator">=</span> <span class="token number">5'd16</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_x<span class="token punctuation">;</span> <span class="token comment">// 计算像素点对应单元格的左上角x坐标</span>
        <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_x<span class="token punctuation">;</span>
        <span class="token keyword keyword-begin">begin</span>
            cell_x <span class="token operator">=</span> <span class="token punctuation">(</span>pix_x <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> H_PIC<span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-endfunction">endfunction</span>

    <span class="token keyword keyword-function">function</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> cell_y<span class="token punctuation">;</span> <span class="token comment">// 计算像素点对应单元格的左上角y坐标</span>
        <span class="token keyword keyword-input">input</span> <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> pix_y<span class="token punctuation">;</span>
        <span class="token keyword keyword-begin">begin</span>
            cell_y <span class="token operator">=</span> <span class="token punctuation">(</span>pix_y <span class="token operator">&gt;&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> H_PIC<span class="token punctuation">;</span>
        <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-endfunction">endfunction</span>

    clk_gen <span class="token function">ck_gen0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">vga_clk</span><span class="token punctuation">(</span>vga_clk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vga_ctrl <span class="token function">vga_ctrl0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>vga_clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">Din</span><span class="token punctuation">(</span><span class="token operator">{</span>pixel<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixel<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pixel<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                        <span class="token punctuation">.</span><span class="token function">row</span><span class="token punctuation">(</span>pix_y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">col</span><span class="token punctuation">(</span>pix_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">G</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">HS</span><span class="token punctuation">(</span>HS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">VS</span><span class="token punctuation">(</span>VS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    target_v <span class="token function">gen_state</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">cell_x</span><span class="token punctuation">(</span><span class="token function">cell_x</span><span class="token punctuation">(</span>pix_x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">cell_y</span><span class="token punctuation">(</span><span class="token function">cell_y</span><span class="token punctuation">(</span>pix_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vga_screen_pic <span class="token function">vga_screen_pic0</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">pix_x</span><span class="token punctuation">(</span>pix_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">pix_y</span><span class="token punctuation">(</span>pix_y<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">game_state</span><span class="token punctuation">(</span>game_state<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">pix_data_out</span><span class="token punctuation">(</span>pixel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">testbench</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span></span></span></span> 文件：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">vga_tb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> R<span class="token punctuation">,</span> G<span class="token punctuation">,</span> B<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> HS<span class="token punctuation">,</span> VS<span class="token punctuation">;</span>

    vga_top <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">G</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">HS</span><span class="token punctuation">(</span>HS<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">VS</span><span class="token punctuation">(</span>VS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 切换游戏状态</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>game_state <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span> <span class="token comment">// 游戏待开始</span>
    <span class="token comment">// defparam test.game_state = 2'b01; // 游戏进行中</span>
    <span class="token comment">// defparam test.game_state = 2'b10; // 游戏结束</span>

    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        clk <span class="token operator">=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
        <span class="token number">#5</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h4 id="游戏开始">游戏开始 </h4>
<p>整体图片：</p>
<p><img src="./vga_part/vga_tb_1.png" alt="vga_tb_1"></p>
<p>局部细节：</p>
<p><img src="./vga_part/vga_tb_2.png" alt="vga_tb_2"></p>
<p>经比对，该数据与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">.coe</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord">.</span><span class="mord mathnormal">coe</span></span></span></span> 文件中的数据相同。</p>
<h2 id="3蜂鸣器">3.蜂鸣器 </h2>
<h3 id="仿真测试-1">仿真测试 </h3>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>b</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">testbench</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">b</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">c</span><span class="mord mathnormal">h</span></span></span></span> 文件：</p>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">beep_tb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span> game_state<span class="token punctuation">;</span>

    <span class="token keyword keyword-wire">wire</span> beep<span class="token punctuation">;</span>
               
    top_beep <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">game_state</span><span class="token punctuation">(</span>game_state<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token function">beep</span><span class="token punctuation">(</span>beep<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 修改参数，缩短仿真时间</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_go<span class="token punctuation">.</span>TIME_125ms <span class="token operator">=</span> <span class="token number">24'd1249</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_go<span class="token punctuation">.</span>AS_4 <span class="token operator">=</span> <span class="token number">18'd21</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_go<span class="token punctuation">.</span>A4 <span class="token operator">=</span> <span class="token number">18'd22</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_go<span class="token punctuation">.</span>GS_4 <span class="token operator">=</span> <span class="token number">18'd24</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_go<span class="token punctuation">.</span>G4 <span class="token operator">=</span> <span class="token number">18'd25</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>TIME_125ms <span class="token operator">=</span> <span class="token number">24'd1249</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>A4 <span class="token operator">=</span> <span class="token number">19'd22</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>D5 <span class="token operator">=</span> <span class="token number">19'd17</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>C5 <span class="token operator">=</span> <span class="token number">19'd19</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>B4 <span class="token operator">=</span> <span class="token number">19'd20</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>FS_4 <span class="token operator">=</span> <span class="token number">19'd27</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>G4 <span class="token operator">=</span> <span class="token number">19'd25</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>D4 <span class="token operator">=</span> <span class="token number">19'd37</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>E4 <span class="token operator">=</span> <span class="token number">19'd30</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>F4 <span class="token operator">=</span> <span class="token number">19'd28</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>bp_gs<span class="token punctuation">.</span>C4 <span class="token operator">=</span> <span class="token number">19'd38</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-defparam">defparam</span> test<span class="token punctuation">.</span>TIME_125ms <span class="token operator">=</span> <span class="token number">26'd6250</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        clk <span class="token operator">=</span> <span class="token number">1'b1</span><span class="token punctuation">;</span>
        game_state <span class="token operator">=</span> <span class="token number">2'b00</span><span class="token punctuation">;</span>
        <span class="token number">#100000</span><span class="token punctuation">;</span>
        game_state <span class="token operator">=</span> <span class="token number">2'b01</span><span class="token punctuation">;</span>
        <span class="token number">#100000</span><span class="token punctuation">;</span>
        game_state <span class="token operator">=</span> <span class="token number">2'b10</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>

    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>
        <span class="token number">#5</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><p>仿真结果已在解释实现步骤时展示。</p>
<h2 id="4状态机">4.状态机 </h2>
<h3 id="仿真代码">仿真代码 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">test_state</span><span class="token punctuation">(</span>

    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> rst<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> start_button<span class="token punctuation">;</span>

    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        rst<span class="token operator">=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
        clk<span class="token operator">=</span><span class="token number">1'b1</span><span class="token punctuation">;</span>
        start_button<span class="token operator">=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    
    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token number">#5</span> clk<span class="token operator">=~</span>clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token number">#100000</span> rst<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#100000</span> start_button<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> start_button<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    
    <span class="token keyword keyword-wire">wire</span> HS<span class="token punctuation">,</span>VS<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> R<span class="token punctuation">,</span>G<span class="token punctuation">,</span>B<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> AN<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> SEG<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> LED<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> beep<span class="token punctuation">;</span>
    top <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">start_button</span><span class="token punctuation">(</span>start_button<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">ps2_clk</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">ps2_data</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">VS</span><span class="token punctuation">(</span>VS<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">HS</span><span class="token punctuation">(</span>HS<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">G</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-defparam">defparam</span> top<span class="token punctuation">.</span>run_module0<span class="token punctuation">.</span>MAX_CNT <span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword keyword-endmodule">endmodule</span>
</code></pre><h3 id="仿真结果">仿真结果 </h3>
<p><img src="./game_state.png" alt="alt text"><br>
游戏初始为<strong>开始界面</strong>状态(<code>2'b00</code>)rst始终置1，当<code>start_button</code>置1时游戏进入<strong>游玩中</strong>状态(<code>2'b01</code>)；当gameover置为1时，游戏进入结束状态(<code>2'b10</code>)；当<code>start_button</code>再次置为1时，<code>gameover</code>重置为0，同时游戏状态重置为<strong>游玩中</strong>(<code>2'b01</code>)</p>
<h2 id="5运动模块">5.运动模块 </h2>
<h3 id="51-方向控制仿真测试">5.1 方向控制仿真测试 </h3>
<pre data-role="codeBlock" data-info="verilog" class="language-verilog verilog"><code><span class="token keyword keyword-module">module</span> <span class="token function">test_state</span><span class="token punctuation">(</span>

    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> rst<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> start_button<span class="token punctuation">;</span>
    <span class="token keyword keyword-reg">reg</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span>dir<span class="token punctuation">;</span>

    <span class="token keyword keyword-initial">initial</span> <span class="token keyword keyword-begin">begin</span>
        rst<span class="token operator">=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
        clk<span class="token operator">=</span><span class="token number">1'b1</span><span class="token punctuation">;</span>
        start_button<span class="token operator">=</span><span class="token number">1'b0</span><span class="token punctuation">;</span>
        dir<span class="token operator">=</span><span class="token number">2'b00</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token comment">// always begin</span>
    <span class="token comment">//     #100 start_button=1;</span>
    <span class="token comment">//     #100 start_button=0;</span>
    <span class="token comment">// end</span>
    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token number">#5</span> clk<span class="token operator">=~</span>clk<span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token number">#100000</span> rst<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#100000</span> start_button<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token number">#10</span> start_button<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token important">always</span> <span class="token keyword keyword-begin">begin</span>
        <span class="token number">#1000</span> dir<span class="token operator">=</span><span class="token number">2'b00</span><span class="token punctuation">;</span>
        <span class="token number">#1000</span> dir<span class="token operator">=</span><span class="token number">2'b01</span><span class="token punctuation">;</span>
        <span class="token number">#1000</span> dir<span class="token operator">=</span><span class="token number">2'b10</span><span class="token punctuation">;</span>
        <span class="token number">#1000</span> dir<span class="token operator">=</span><span class="token number">2'b11</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-end">end</span>
    <span class="token keyword keyword-wire">wire</span> HS<span class="token punctuation">,</span>VS<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> R<span class="token punctuation">,</span>G<span class="token punctuation">,</span>B<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> AN<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> SEG<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> LED<span class="token punctuation">;</span>
    <span class="token keyword keyword-wire">wire</span> beep<span class="token punctuation">;</span>
    top <span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token function">rst</span><span class="token punctuation">(</span>rst<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">start_button</span><span class="token punctuation">(</span>start_button<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">ps2_clk</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">ps2_data</span><span class="token punctuation">(</span><span class="token number">1'b0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">VS</span><span class="token punctuation">(</span>VS<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">HS</span><span class="token punctuation">(</span>HS<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">R</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">G</span><span class="token punctuation">(</span>G<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword keyword-defparam">defparam</span> top<span class="token punctuation">.</span>run_module0<span class="token punctuation">.</span>MAX_CNT <span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword keyword-endmodule">endmodule</span>

</code></pre><p><img src="./run_part/5.1_dir.png" alt="alt text"><br>
测试每1000ns改变一次dir信号：每当<code>game_clk</code>为正边沿时，改变<code>current_dir</code>为<code>dir</code>，同时有限制条件：当欲改变方向与运动方向相反时，不会发生改变。</p>
<p>激励图中，蛇分别发生向上、向右、向下、向左的运动，xy坐标发生对应正确的变化。</p>
<h3 id="52-触碰障碍或身体">5.2 触碰障碍或身体 </h3>
<p>触碰身体：<br>
<img src="./run_part/5.2_bodydead.png" alt="bodydead"><br>
人为在 (30,15)放置了一个不动的身体块(即<code>state[30][15]=3'b010</code>)，当head坐标移动到(30,15)时<code>gameover</code>置1，游戏结束。</p>
<hr>
<p>触碰障碍：<br>
<img src="./run_part/5.2_blockdead.png" alt="blockdead"><br>
初始不改变蛇移动方向，径直向右移动到最边界(39,15)，<code>gameover</code>置1，游戏结束</p>
<h3 id="53-移动到空白格">5.3 移动到空白格 </h3>
<p><img src="./run_part/5.3_empty.png" alt="empty"><br>
图中监测了蛇头的x坐标和两个身子的坐标，以及途径的(21,15)(22,15)(23,15)(24,15)四处位置的状态变化；</p>
<p>可以清楚看到蛇头坐标正确增加的同时，身子坐标随之挪动，并且沿途格子依次状态从空白变为头、身再到空白</p>
<h3 id="54-吃到食物">5.4 吃到食物 </h3>
<p><img src="./run_part/5.4_food.png" alt="food"><br>
初始在(25,15)放置了小食物，在蛇头抵达前score=0和length=1；<br>
当吃到食物后，新产生随机的食物坐标，并且身体增长，body_x[3]出现新的值，length增长，score增加</p>
<h1 id="上板结果分析">上板结果分析 </h1>
<h1 id="小组成员分工及贡献比例">小组成员分工及贡献比例 </h1>
<h1 id="实现过程中所参考的所有代码的链接">实现过程中所参考的所有代码的链接 </h1>

      </div>
      <div class="md-sidebar-toc">
<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#逻辑设计思路" class="md-toc-link"><p>逻辑设计思路</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#整体设计" class="md-toc-link">
            <p>整体设计</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1ps2设计思路" class="md-toc-link"><p>1.PS2设计思路</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#运行原理" class="md-toc-link">
            <p>运行原理</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#代码思路" class="md-toc-link"><p>代码思路：</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#11-输入输出信号" class="md-toc-link">
            <p>1.1 输入输出信号</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#12-转化为方向信息以及实现键盘防抖动" class="md-toc-link">
            <p>1.2 转化为方向信息以及实现键盘防抖动</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2vga设计思路" class="md-toc-link"><p>2.VGA设计思路</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#21-clk_gen模块" class="md-toc-link">
            <p>2.1 clk_gen模块</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#22-vga_ctrl模块" class="md-toc-link">
            <p>2.2 vga_ctrl模块</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#23-vga_screen_pic模块" class="md-toc-link"><p>2.3 vga_screen_pic模块</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#231-ip核的生成" class="md-toc-link"><p>2.3.1 IP核的生成</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#图片制作" class="md-toc-link"><p>图片制作</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏开始画面" class="md-toc-link">
            <p>游戏开始画面</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏结束画面" class="md-toc-link">
            <p>游戏结束画面</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏中画面" class="md-toc-link">
            <p>游戏中画面</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#图片处理" class="md-toc-link">
            <p>图片处理</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#生成ip核" class="md-toc-link">
            <p>生成IP核</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#ip核的调用" class="md-toc-link">
            <p>IP核的调用</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3蜂鸣器设计思路" class="md-toc-link"><p>3.蜂鸣器设计思路</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#蜂鸣器原理" class="md-toc-link">
            <p>蜂鸣器原理</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#实现步骤" class="md-toc-link"><p>实现步骤</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏开始音乐" class="md-toc-link">
            <p>游戏开始音乐</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏结束音乐" class="md-toc-link">
            <p>游戏结束音乐</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#top_beep-模块" class="md-toc-link">
            <p>top_beep 模块</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#4状态机设计思路" class="md-toc-link">
            <p>4.状态机设计思路</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#5运动模块设计思路" class="md-toc-link"><p>5.运动模块设计思路</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#51-io信号代码" class="md-toc-link">
            <p>5.1 IO信号代码</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#52-定义代码" class="md-toc-link">
            <p>5.2 定义代码</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#53-初始化" class="md-toc-link">
            <p>5.3 初始化</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#54-重置游戏" class="md-toc-link">
            <p>5.4 重置游戏</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#55-蛇的运动" class="md-toc-link"><p>5.5 蛇的运动</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#551-方向控制" class="md-toc-link">
            <p>5.5.1 方向控制</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#552-触碰障碍或身体" class="md-toc-link">
            <p>5.5.2 触碰障碍或身体</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#553-移动到空白格" class="md-toc-link">
            <p>5.5.3 移动到空白格</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#554-吃到食物" class="md-toc-link">
            <p>5.5.4 吃到食物</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#仿真与调试过程分析" class="md-toc-link"><p>仿真与调试过程分析</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#1ps2" class="md-toc-link"><p>1.PS2</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#上版功能验证" class="md-toc-link">
            <p>上版功能验证</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#2vga" class="md-toc-link"><p>2.VGA</p>
</a>
          </summary>
        <div>
          <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#仿真测试" class="md-toc-link"><p>仿真测试</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#游戏开始" class="md-toc-link">
            <p>游戏开始</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#3蜂鸣器" class="md-toc-link"><p>3.蜂鸣器</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#仿真测试-1" class="md-toc-link">
            <p>仿真测试</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#4状态机" class="md-toc-link"><p>4.状态机</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#仿真代码" class="md-toc-link">
            <p>仿真代码</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#仿真结果" class="md-toc-link">
            <p>仿真结果</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#5运动模块" class="md-toc-link"><p>5.运动模块</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#51-方向控制仿真测试" class="md-toc-link">
            <p>5.1 方向控制仿真测试</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#52-触碰障碍或身体" class="md-toc-link">
            <p>5.2 触碰障碍或身体</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#53-移动到空白格" class="md-toc-link">
            <p>5.3 移动到空白格</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#54-吃到食物" class="md-toc-link">
            <p>5.4 吃到食物</p>

          </a></div>
        </div>
      </details>
    
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#上板结果分析" class="md-toc-link">
            <p>上板结果分析</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#小组成员分工及贡献比例" class="md-toc-link">
            <p>小组成员分工及贡献比例</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:18px">
          <a href="#实现过程中所参考的所有代码的链接" class="md-toc-link">
            <p>实现过程中所参考的所有代码的链接</p>

          </a></div>
</div>
</div>
      <a id="sidebar-toc-btn">≡</a>
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>